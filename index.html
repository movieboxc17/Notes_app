<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Simple Notes ‚Äî Mobile Friendly</title>
<style>
  :root{
    --bg: #f7f8fb;
    --card: #ffffff;
    --muted: #6b7280;
    --accent: #2563eb;
    --radius: 12px;
    --shadow: 0 6px 18px rgba(16,24,40,0.06);
    --glass: rgba(255,255,255,0.6);
  }

  /* Basic reset */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#0f172a;background:linear-gradient(180deg,#f9fafb, #f3f4f6)}
  a{color:inherit}

  /* App container */
  .app {
    max-width:1100px;
    margin:0 auto;
    padding:14px;
    display:grid;
    grid-template-columns: 1fr;
    gap:12px;
  }

  /* Header */
  header {
    display:flex;
    align-items:center;
    gap:12px;
    padding:8px;
  }
  .brand { font-weight:700; font-size:18px; }
  .search {
    flex:1;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .search input {
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(15,23,42,0.06);
    background:var(--card);
    font-size:15px;
  }
  .icon-btn {
    width:44px; height:44px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center;
    background:var(--card); border:1px solid rgba(15,23,42,0.04); box-shadow:var(--shadow); cursor:pointer;
    font-size:18px;
  }

  /* Content layout (mobile friendly) */
  .main {
    display:flex;
    flex-direction:column;
    gap:10px;
    padding:8px;
  }

  /* Tag chips */
  .chips {
    display:flex;
    gap:8px;
    overflow:auto;
    padding:4px 2px;
  }
  .chip {
    flex:0 0 auto;
    padding:8px 12px;
    background:rgba(15,23,42,0.04);
    color:var(--muted);
    border-radius:999px;
    cursor:pointer;
    font-size:14px;
  }
  .chip.active {
    background:linear-gradient(90deg,var(--accent), color-mix(in srgb, var(--accent) 80%, white));
    color:white;
    font-weight:600;
  }

  /* Notes list */
  .notes {
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .note {
    display:flex;
    gap:12px;
    align-items:flex-start;
    padding:12px;
    background:var(--card);
    border-radius:12px;
    box-shadow:var(--shadow);
    border:1px solid rgba(15,23,42,0.03);
    cursor:pointer;
  }
  .note .meta {
    flex:1;
    min-width:0;
  }
  .note .title {
    font-weight:700;
    font-size:16px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .note .preview {
    color:#475569;
    font-size:14px;
    margin-top:6px;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }
  .note .right {
    display:flex;
    flex-direction:column;
    gap:8px;
    align-items:flex-end;
  }
  .note .pill {
    font-size:12px;
    padding:6px 8px;
    background:rgba(99,102,241,0.08);
    border-radius:999px;
    color:#3730a3;
  }
  .note small { color:var(--muted); }

  /* Floating new button */
  .fab {
    position:fixed;
    right:16px;
    bottom:18px;
    width:56px;
    height:56px;
    border-radius:50%;
    background:var(--accent);
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    box-shadow:0 12px 30px rgba(37,99,235,0.18);
    border:none;
    cursor:pointer;
    z-index:30;
  }

  /* Bottom sheet editor (mobile friendly) */
  .sheet {
    position:fixed;
    left:0;
    right:0;
    bottom:-100%;
    background:linear-gradient(180deg, #ffffff, #fbfdff);
    border-top-left-radius:18px;
    border-top-right-radius:18px;
    box-shadow:0 -16px 40px rgba(2,6,23,0.12);
    transition:bottom .28s cubic-bezier(.2,.9,.2,1);
    padding:14px;
    z-index:40;
    max-height:92vh;
    overflow:auto;
  }
  .sheet.open { bottom:0; }
  .sheet .handle { width:36px; height:4px; background:#e6e9ef; border-radius:6px; margin:6px auto; }
  .sheet .row { display:flex; gap:8px; align-items:center; margin-top:8px; }
  .sheet input[type="text"], .sheet textarea {
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(15,23,42,0.06);
    font-size:15px;
  }
  .sheet textarea { min-height:160px; resize:vertical; }
  .sheet .actions { display:flex; gap:8px; margin-top:10px; justify-content:flex-end; }
  .btn {
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(15,23,42,0.06);
    background:var(--card);
    cursor:pointer;
    font-weight:600;
  }
  .btn.primary { background:var(--accent); color:white; border:0; }
  .btn.danger { background:#fff5f5; color:#b91c1c; border:1px solid rgba(185,28,28,0.08); }

  /* Small screen friendly touch area */
  button, .chip { touch-action:manipulation; }

  /* Simple settings drawer (overlay) */
  .settings {
    position:fixed;
    right:12px;
    top:12px;
    background:var(--card);
    border-radius:12px;
    padding:10px;
    box-shadow:var(--shadow);
    border:1px solid rgba(15,23,42,0.04);
    display:none;
    z-index:50;
  }
  .settings.open { display:block; }

  /* Responsive: two-column on wider screens */
  @media(min-width:900px){
    .app { grid-template-columns: 1fr 420px; align-items:start; }
    header { padding:0 8px; }
    .main { padding:0 }
    .sheet { left:50%; transform:translateX(-50%); width:560px; border-radius:14px; }
  }

  mark { background: #fde68a; padding:0 2px; border-radius:3px; color:#111827; }
</style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="brand">Simple Notes</div>
      <div class="search">
        <input id="search" type="search" placeholder="Search notes or tags..." aria-label="Search notes">
      </div>
      <button id="settingsToggle" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    </header>

    <div class="main">
      <div class="chips" id="tagChips" aria-hidden="false"></div>

      <div class="notes" id="notesList" aria-live="polite"></div>
    </div>
  </div>

  <button class="fab" id="fab" aria-label="New note">Ôºã</button>

  <!-- Bottom sheet editor -->
  <div class="sheet" id="editorSheet" aria-hidden="true">
    <div class="handle" aria-hidden="true"></div>
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <strong id="editorTitle">New Note</strong>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="duplicateBtn" class="btn" title="Duplicate">Duplicate</button>
        <button id="deleteBtn" class="btn danger" title="Delete">Delete</button>
      </div>
    </div>

    <div class="row" style="margin-top:10px;">
      <input id="noteTitle" type="text" placeholder="Title">
      <button id="pinBtn" class="btn" title="Pin/unpin">üìå</button>
      <button id="lockBtn" class="btn" title="Lock/unlock">üîí</button>
    </div>

    <div class="row" style="margin-top:8px;">
      <input id="tagInput" type="text" placeholder="Add tag and press Enter">
      <button id="addTagBtn" class="btn">Add</button>
    </div>
    <div class="chips" id="editorTags" style="margin-top:8px"></div>

    <div style="margin-top:8px">
      <textarea id="noteBody" placeholder="Write your note..."></textarea>
    </div>

    <div class="actions">
      <button id="closeEditor" class="btn">Close</button>
      <button id="saveNote" class="btn primary">Save</button>
    </div>
  </div>

  <div class="settings" id="settings" role="dialog" aria-modal="false" aria-hidden="true">
    <div style="display:flex; align-items:center; gap:10px;">
      <label for="accentColor" style="font-weight:600">Accent</label>
      <input id="accentColor" type="color" value="#2563eb" />
    </div>
    <div style="margin-top:8px;">
      <label style="display:block;font-weight:600">Lock PIN (optional)</label>
      <input id="pinInput" type="text" placeholder="Set a 4+ digit PIN" style="padding:8px;border-radius:8px;border:1px solid rgba(15,23,42,0.06);width:100%" />
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="savePin" class="btn">Save PIN</button>
        <button id="clearPin" class="btn">Clear PIN</button>
      </div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end;">
      <button id="closeSettings" class="btn">Close</button>
    </div>
  </div>

<script>
/*
  Simple Notes ‚Äî mobile-first single-file app
  - Storage: localStorage
  - Features: create/edit/delete/duplicate/pin/lock/tags/search/sort recent-title
  - Editor: bottom-sheet modal for comfortable mobile typing
*/

(function(){
  // Utilities
  const STORAGE_KEY = 'simple_notes_v1';
  const SETTINGS_KEY = 'simple_notes_settings_v1';
  function uid(){ return 'n-' + Math.random().toString(36).slice(2,10); }
  function nowISO(){ return new Date().toISOString(); }
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }
  function relTime(iso){
    const d = new Date(iso), diff = Math.floor((Date.now()-d)/1000);
    if(diff<60) return diff+'s';
    if(diff<3600) return Math.floor(diff/60)+'m';
    if(diff<86400) return Math.floor(diff/3600)+'h';
    return d.toLocaleDateString();
  }
  function saveNotes(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(notes)); }
  function saveSettings(){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings)); }

  // Simple PIN "hash" (not security-grade, just to avoid storing plain text)
  function pinHash(pin){ try{ return btoa(pin.split('').reverse().join('')); }catch(e){return pin;} }
  function checkPin(pin, hash){ return pinHash(pin) === hash; }

  // DOM
  const els = {
    search: document.getElementById('search'),
    tagChips: document.getElementById('tagChips'),
    notesList: document.getElementById('notesList'),
    fab: document.getElementById('fab'),
    editorSheet: document.getElementById('editorSheet'),
    noteTitle: document.getElementById('noteTitle'),
    noteBody: document.getElementById('noteBody'),
    addTagBtn: document.getElementById('addTagBtn'),
    tagInput: document.getElementById('tagInput'),
    editorTags: document.getElementById('editorTags'),
    saveNote: document.getElementById('saveNote'),
    closeEditor: document.getElementById('closeEditor'),
    deleteBtn: document.getElementById('deleteBtn'),
    duplicateBtn: document.getElementById('duplicateBtn'),
    pinBtn: document.getElementById('pinBtn'),
    lockBtn: document.getElementById('lockBtn'),
    settingsToggle: document.getElementById('settingsToggle'),
    settingsPanel: document.getElementById('settings'),
    accentColor: document.getElementById('accentColor'),
    pinInput: document.getElementById('pinInput'),
    savePin: document.getElementById('savePin'),
    clearPin: document.getElementById('clearPin'),
    closeSettings: document.getElementById('closeSettings'),
    searchInput: document.getElementById('search'),
    tagChipsWrapper: document.getElementById('tagChips')
  };

  // Data
  let notes = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null') || [
    { id: uid(), title:'Welcome', body:'This is your first note. Tap + to create another.', tags:['welcome'], pinned:true, locked:false, createdAt:nowISO(), updatedAt:nowISO() }
  ];
  let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || 'null') || { accent:'#2563eb', pinHash:null, showTags:true, sort:'recent' };

  // UI state
  let currentId = null;
  let selectedTag = null;

  // Init UI values
  els.accentColor.value = settings.accent || '#2563eb';
  document.documentElement.style.setProperty('--accent', settings.accent || '#2563eb');

  // Render helpers
  function allTags(){
    const s = new Set();
    notes.forEach(n => (n.tags||[]).forEach(t => { if(t && t.trim()) s.add(t.trim()); }));
    return Array.from(s).sort();
  }

  function filterAndSort(){
    const q = (els.search.value || '').trim().toLowerCase();
    let arr = notes.slice();
    if(q){
      arr = arr.filter(n => (n.title||'').toLowerCase().includes(q) || (n.body||'').toLowerCase().includes(q) || (n.tags || []).join(' ').toLowerCase().includes(q));
    }
    if(selectedTag){
      arr = arr.filter(n => (n.tags||[]).some(t => t.toLowerCase() === selectedTag.toLowerCase()));
    }
    if(settings.sort === 'title'){
      arr.sort((a,b)=> (''+a.title).localeCompare(''+b.title));
    } else {
      arr.sort((a,b)=> new Date(b.updatedAt) - new Date(a.updatedAt));
    }
    // keep pinned first
    arr.sort((a,b)=> (b.pinned - a.pinned));
    return arr;
  }

  function renderChips(){
    els.tagChips.innerHTML = '';
    if(!settings.showTags) return;
    const all = document.createElement('button'); all.className='chip' + (selectedTag===null ? ' active' : ''); all.textContent='All';
    all.onclick = ()=> { selectedTag = null; render(); };
    els.tagChips.appendChild(all);
    allTags().forEach(t => {
      const b = document.createElement('button');
      b.className = 'chip' + (selectedTag===t ? ' active' : '');
      b.textContent = t;
      b.onclick = ()=> { selectedTag = t; render(); };
      els.tagChips.appendChild(b);
    });
  }

  function renderNotes(){
    const arr = filterAndSort();
    els.notesList.innerHTML = '';
    if(arr.length === 0){
      const empty = document.createElement('div');
      empty.style.padding = '28px';
      empty.style.textAlign = 'center';
      empty.innerHTML = '<div style="font-weight:700;margin-bottom:6px">No notes</div><div style="color:var(--muted)">Tap + to create one</div>';
      els.notesList.appendChild(empty);
      return;
    }
    arr.forEach(n => {
      const elNote = document.createElement('div');
      elNote.className = 'note';
      elNote.setAttribute('data-id', n.id);

      const meta = document.createElement('div');
      meta.className = 'meta';

      const title = document.createElement('div');
      title.className = 'title';
      title.innerHTML = highlight(n.title || firstLine(n.body) || 'Untitled', els.search.value || '');

      const preview = document.createElement('div');
      preview.className = 'preview';
      preview.innerHTML = highlight(previewLine(n), els.search.value || '');

      meta.appendChild(title);
      meta.appendChild(preview);

      const right = document.createElement('div');
      right.className = 'right';
      const pill = document.createElement('div');
      pill.className = 'pill';
      pill.textContent = relTime(n.updatedAt);
      right.appendChild(pill);

      if(n.pinned){
        const pin = document.createElement('div');
        pin.className = 'pill';
        pin.textContent = 'Pinned';
        pin.style.background = '#fff7ed';
        pin.style.color = '#92400e';
        right.appendChild(pin);
      }
      if(n.locked){
        const lock = document.createElement('div');
        lock.className = 'pill';
        lock.textContent = 'Locked';
        lock.style.background = '#fff7f7';
        lock.style.color = '#7f1d1d';
        right.appendChild(lock);
      }

      elNote.appendChild(meta);
      elNote.appendChild(right);

      // click to open
      elNote.addEventListener('click', () => openEditor(n.id));
      els.notesList.appendChild(elNote);
    });
  }

  function highlight(text, q){
    if(!q) return escapeHtml(text||'');
    const esc = q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
    return escapeHtml(text||'').replace(new RegExp(esc,'ig'), m => `<mark>${m}</mark>`);
  }

  function firstLine(s){ return (s||'').split(/\n/).find(l=>l && l.trim()) || ''; }
  function previewLine(n){
    const lines = (n.body||'').split(/\n/).map(l=>l.trim()).filter(Boolean);
    if(!(n.title||'').trim()) return lines[1] || lines[0] || '';
    return lines[0] || '';
  }

  // Editor functions
  function openEditor(id){
    const note = notes.find(n => n.id === id);
    if(!note) return;
    if(note.locked){
      if(!settings.pinHash){ alert('Note is locked but no PIN is set in Settings.'); return; }
      const p = prompt('Enter PIN to unlock');
      if(!p || !checkPin(p, settings.pinHash)){ alert('Wrong PIN'); return; }
    }
    currentId = id;
    els.noteTitle.value = note.title;
    els.noteBody.value = note.body;
    renderEditorTags(note.tags || []);
    setEditorButtons(note);
    openSheet();
  }

  function openNewNote(){
    currentId = null;
    els.noteTitle.value = '';
    els.noteBody.value = '';
    renderEditorTags([]);
    setEditorButtons(null);
    openSheet();
  }

  function setEditorButtons(note){
    const isNew = !note;
    els.deleteBtn.style.display = isNew ? 'none' : 'inline-block';
    els.duplicateBtn.style.display = isNew ? 'none' : 'inline-block';
    els.pinBtn.textContent = (note && note.pinned) ? 'Unpin' : 'üìå';
    els.lockBtn.textContent = (note && note.locked) ? 'Unlock' : 'üîí';
    document.getElementById('editorTitle').textContent = isNew ? 'New Note' : 'Edit Note';
  }

  function openSheet(){ els.editorSheet.classList.add('open'); els.editorSheet.setAttribute('aria-hidden','false'); setTimeout(()=>els.noteTitle.focus(),180); }
  function closeSheet(){ els.editorSheet.classList.remove('open'); els.editorSheet.setAttribute('aria-hidden','true'); currentId = null; }

  function renderEditorTags(tags){
    els.editorTags.innerHTML = '';
    (tags||[]).forEach(t => {
      const b = document.createElement('div'); b.className = 'chip'; b.textContent = t;
      b.onclick = ()=> { b.remove(); };
      els.editorTags.appendChild(b);
    });
  }

  function saveFromEditor(){
    const title = (els.noteTitle.value || '').trim();
    const body = els.noteBody.value || '';
    const tagEls = Array.from(els.editorTags.children);
    const tags = tagEls.map(c => c.textContent.trim());
    if(currentId){
      const n = notes.find(x=>x.id === currentId);
      if(!n) return;
      n.title = title;
      n.body = body;
      n.tags = tags;
      n.updatedAt = nowISO();
    } else {
      const n = { id: uid(), title, body, tags, pinned:false, locked:false, createdAt: nowISO(), updatedAt: nowISO() };
      notes.unshift(n);
      currentId = n.id;
    }
    saveNotes();
    render();
    closeSheet();
  }

  // Editor actions
  els.addTagBtn.addEventListener('click', () => {
    const v = (els.tagInput.value||'').trim();
    if(!v) return;
    // avoid duplicates
    const existing = Array.from(els.editorTags.children).map(c=>c.textContent);
    if(existing.includes(v)) { els.tagInput.value=''; return; }
    const b = document.createElement('div'); b.className = 'chip'; b.textContent = v;
    b.onclick = ()=> b.remove();
    els.editorTags.appendChild(b);
    els.tagInput.value = '';
  });
  els.tagInput.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); els.addTagBtn.click(); } });

  els.saveNote.addEventListener('click', saveFromEditor);
  els.closeEditor.addEventListener('click', closeSheet);

  els.deleteBtn.addEventListener('click', () => {
    if(!currentId) return;
    if(!confirm('Delete this note?')) return;
    notes = notes.filter(n=>n.id !== currentId);
    saveNotes();
    render();
    closeSheet();
  });

  els.duplicateBtn.addEventListener('click', () => {
    if(!currentId) return;
    const n = notes.find(x=>x.id===currentId);
    if(!n) return;
    const copy = JSON.parse(JSON.stringify(n));
    copy.id = uid(); copy.title = copy.title ? copy.title + ' copy' : '';
    copy.createdAt = nowISO(); copy.updatedAt = nowISO();
    notes.unshift(copy);
    saveNotes();
    render();
    closeSheet();
  });

  els.pinBtn.addEventListener('click', () => {
    if(!currentId){ // toggles for new note only toggles UI state
      const isPinned = els.pinBtn.getAttribute('data-pinned') === '1';
      els.pinBtn.setAttribute('data-pinned', isPinned ? '0' : '1');
      els.pinBtn.textContent = isPinned ? 'üìå' : 'Unpin';
      return;
    }
    const n = notes.find(x=>x.id===currentId); if(!n) return;
    n.pinned = !n.pinned; n.updatedAt = nowISO(); saveNotes(); setEditorButtons(n); render();
  });

  els.lockBtn.addEventListener('click', () => {
    if(!currentId){
      alert('You can lock saved notes only. Save the note first then lock it.');
      return;
    }
    const n = notes.find(x=>x.id===currentId); if(!n) return;
    if(!n.locked){
      if(!settings.pinHash){ if(!confirm('No PIN set. Set one in Settings first.')) return; }
      if(settings.pinHash){
        n.locked = true; n.updatedAt = nowISO(); saveNotes(); setEditorButtons(n); render();
      }
    } else {
      const p = prompt('Enter PIN to unlock');
      if(!p) return;
      if(checkPin(p, settings.pinHash)){ n.locked = false; n.updatedAt = nowISO(); saveNotes(); setEditorButtons(n); render(); }
      else alert('Wrong PIN');
    }
  });

  // Create new note
  els.fab.addEventListener('click', openNewNote);

  // Search
  els.search.addEventListener('input', () => render());

  // Settings toggle
  els.settingsToggle.addEventListener('click', () => {
    els.settingsPanel.classList.toggle('open');
  });
  els.closeSettings.addEventListener('click', () => { els.settingsPanel.classList.remove('open'); });

  els.accentColor.addEventListener('input', (e) => {
    settings.accent = e.target.value;
    document.documentElement.style.setProperty('--accent', settings.accent);
    saveSettings();
  });

  els.savePin.addEventListener('click', () => {
    const p = (els.pinInput.value || '').trim();
    if(!p || p.length < 4){ alert('Enter a PIN with 4 or more characters'); return; }
    settings.pinHash = pinHash(p);
    saveSettings();
    els.pinInput.value = '';
    alert('PIN saved (browser storage, not secure).');
  });
  els.clearPin.addEventListener('click', () => {
    if(confirm('Clear saved PIN?')){ settings.pinHash = null; saveSettings(); alert('PIN cleared'); }
  });

  // Tag chips click (rendered in renderChips)
  // Initial render
  function render(){
    renderChips();
    renderNotes();
  }

  // Utilities used above
  function nowISO(){ return new Date().toISOString(); }

  // highlight helper repeated here (local)
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }
  function relTime(iso){
    const d = new Date(iso), diff = Math.floor((Date.now()-d)/1000);
    if(diff<60) return diff+'s';
    if(diff<3600) return Math.floor(diff/60)+'m';
    if(diff<86400) return Math.floor(diff/3600)+'h';
    return d.toLocaleDateString();
  }

  // initialize
  render();

  // make sheet draggable by handle (simple)
  (function sheetDrag(){
    const sheet = els.editorSheet;
    const handle = sheet.querySelector('.handle');
    if(!handle) return;
    let startY = 0, startBottom = 0, dragging=false;
    handle.addEventListener('touchstart', e => {
      dragging = true;
      startY = e.touches[0].clientY;
      startBottom = parseFloat(getComputedStyle(sheet).bottom);
    });
    handle.addEventListener('touchmove', e => {
      if(!dragging) return;
      const dy = e.touches[0].clientY - startY;
      const newBottom = Math.min(0, startBottom - dy);
      sheet.style.bottom = (newBottom) + 'px';
    });
    handle.addEventListener('touchend', e => {
      dragging = false;
      if(parseFloat(sheet.style.bottom) < -120) closeSheet();
      else sheet.style.bottom = '0';
    });
  })();

})();
</script>
</body>
</html>
